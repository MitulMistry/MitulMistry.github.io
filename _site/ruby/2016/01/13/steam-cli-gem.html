<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Steam Top Sellers CLI Gem</title>
    <meta name="description" content="Mitul Mistry, full-stack developer and designer
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://mitulmistry.github.io//ruby/2016/01/13/steam-cli-gem.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Mitul Mistry - Tech Blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Steam Top Sellers CLI Gem</h1>
    <p class="post-meta">Jan 13, 2016</p>
  </header>

  <article class="post-content">
    <p>In my process of learning Ruby, I’ve been working on a CLI gem that I’ll discuss here. My goal was to create a command line interface that could retrieve a list of the currently top selling games at the <a href="http://store.steampowered.com/">Steam Store</a>. Upon retrieving the list, the user would then be able to select a game and get more detailed information.</p>

<p>The original intention was to organize the project through three classes: a <code>Scraper</code>, <code>Game</code>, and <code>CLI</code>. The Scraper would be responsible for scraping the data from the Steam website. The <code>Game</code> class would be used to instantiate objects for each game based on data retrieved by the <code>Scraper</code>. The <code>CLI</code> would then be used to tie the other classes together and create an interface for the user to interact with this data. In execution, most of this would go according to plan, but there would be some changes necessary.</p>

<p>I initially used Nokogiri for the <code>Scraper</code> class, then manually navigated through the CSS selectors on the Steam Store frontpage as well as the individual game pages. It was a tedious process, but worked well enough to acquire the necessary data. However, two major roadblocks soon arose:</p>

<p>1) For certain games, the Steam Store would put up an age verification page before allowing the user to continue to the game page, and when using Open-URI to access the page, it would be blocked. I looked into ways of getting around the age verification and it involved creating a cookie, but that was out of scope of what I wanted to accomplish with the project.</p>

<p>2) As soon as I finished the <code>Scraper</code> methods, the Steam Store changed its entire website and CSS structure for its holiday sale, and rewriting the methods temporarily only to revert to the old methods when the sale was over seemed tedious and inefficient.</p>

<p>So after doing some research, I was able to find a better way: leveraging the Steam Storefront API. I created a new class, <code>SteamAPIHandler</code>, to acquire the JSON data and parse it, using the data to create <code>Game</code> objects that could then interact with the <code>CLI</code>. This allowed me access to a much larger amount of data and proved to be much more efficient as well. For example, here’s an old <code>Scraper</code> method:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">scrape_top_sellers</span><span class="p">(</span><span class="n">store_url</span><span class="p">)</span>
  <span class="n">return_array</span> <span class="o">=</span> <span class="o">[]</span> <span class="c1">#empty array that will contain the game hashes to return at the end of the method</span>

  <span class="c1">#OPEN URL</span>
  <span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">store_url</span><span class="p">))</span> <span class="c1">#uses open-uri to open the url, then uses Nokogiri to parse in the html which we will then use to scrape data</span>

  <span class="c1">#PARSE PAGE FOR DATA</span>
  <span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;div.tab_content#tab_topsellers_content div.tab_item&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="c1">#iterates over each game listing on the site, and gets name, location, and url</span>
    <span class="n">return_array</span> <span class="o">&lt;&lt;</span> <span class="p">{</span> <span class="c1">#pushes a hash of game data onto the array</span>
      <span class="ss">title</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;div.tab_item_name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="c1">#uses css to select the appropriate data</span>
      <span class="ss">price</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;div.discount_final_price&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
      <span class="ss">genres</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;div.tab_item_top_tags&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
      <span class="ss">url</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;a.tab_item_overlay&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">{</span> <span class="o">|</span><span class="n">link</span><span class="o">|</span> <span class="n">link</span><span class="o">[</span><span class="s1">&#39;href&#39;</span><span class="o">]</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span><span class="p">,</span>
      <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">return_array</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">i</span><span class="o">[</span><span class="ss">:url</span><span class="o">].</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="c1">#splits the link into individual elements between the /s</span>
    <span class="n">x</span><span class="o">.</span><span class="n">pop</span> <span class="c1">#gets rid of the ?info at the end of the link</span>
    <span class="n">i</span><span class="o">[</span><span class="ss">:steam_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">last</span> <span class="c1">#sets the steam id to the end element of the link</span>
    <span class="n">i</span><span class="o">[</span><span class="ss">:url</span><span class="o">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="c1">#joins the url and saves it without the ?info</span>
  <span class="k">end</span>

  <span class="n">return_array</span>
<span class="k">end</span></code></pre></div>

<p>…compared to a new <code>SteamAPIHandler</code> method that accomplishes the same thing:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">get_top_sellers</span>
  <span class="n">doc</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;http://store.steampowered.com/api/featuredcategories/?cc=US&quot;</span><span class="p">)</span> <span class="c1">#uses Open-URI to get the JSON file, ?cc=US for US currency</span>
  <span class="n">data_hash</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="c1">#loads the JSON data</span>
  <span class="n">data_hash</span><span class="o">[</span><span class="s2">&quot;top_sellers&quot;</span><span class="o">][</span><span class="s2">&quot;items&quot;</span><span class="o">]</span> <span class="c1">#selects desired part of hash</span>
<span class="k">end</span></code></pre></div>

<p>In practice, the <code>CLI</code>, upon loading, uses the <code>SteamAPIHandler</code> to acquire the top sellers and create <code>Game</code> objects from the data. It prints out the information on the screen, then, when the user selects a game to get more information on, the <code>CLI</code> uses the <code>SteamAPIHandler</code> to acquire additional data and print it out. I had a method that acquired the additional information as soon as the <code>CLI</code> loaded, but it caused additional load time as it had to make ten queries to the API in succession, as opposed to one at a time where the load time is much less noticeable.</p>

<p>Overall, it was a good learning experience and I accomplished what I had set out to do. You can see the source code for this project <a href="https://github.com/MitulMistry/steam-top-sellers-cli-gem">here on Github.</a></p>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Mitul Mistry - Tech Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Mitul Mistry - Tech Blog</li>
          <li><a href="mailto:MitulMistryDev@gmail.com">MitulMistryDev@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/MitulMistry">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">MitulMistry</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/mmystic">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">mmystic</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Mitul Mistry, full-stack developer and designer
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
