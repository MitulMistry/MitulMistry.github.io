<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Rails Project - Storyplan &#8211; Mitul Mistry - Tech Blog</title>
<meta name="description" content="The technical blog of Mitul Mistry.">
<meta name="keywords" content="">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@mmystic">
<meta name="twitter:creator" content="@mmystic">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Rails Project - Storyplan">
<meta property="og:description" content="The technical blog of Mitul Mistry.">
<meta property="og:url" content="/ruby/rails/rails-project/">
<meta property="og:site_name" content="Mitul Mistry - Tech Blog">
<meta property="og:image" content="/images/images/logo_mm2.png">





<link rel="canonical" href="/ruby/rails/rails-project/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Mitul Mistry - Tech Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/jquery.mmenu.all.css">
<link rel="stylesheet" href="/assets/css/jquery.floating-social-share.min.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script type="text/javascript" src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">




</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->



<div class="header-menu header-menu-top">
    <ul class="header-item-container">
      <li class="header-item-title header-toggle "><a href="#menu"><h2><i class="fa fa-bars"></i></h2></a></li>
      <li class="header-item-title">
        <a href="/">
          
            <img class="logo" src="/images/logo_mm2.png" alt="Mitul Mistry - Tech Blog">
          
          <a href="/" class="title"> Mitul Mistry - Tech Blog</a>
        </a>
      </li>
      
        
        

        
          <li class="header-item "><a href="/categories"><h3>Categories</h3></a>
            <ul class="header-submenu">
              
                
                  <li class="sub-item"><a href="/categories/#rails">rails</a></li>
              
                
                  <li class="sub-item"><a href="/categories/#ruby">ruby</a></li>
              
                
                  <li class="sub-item"><a href="/categories/#sinatra">sinatra</a></li>
              
            </ul>
          </li>
        
      
        
        

        
            
                <li class="header-item "><a href="/about"><h3>About</h3></a></li>
            
        
      
        
        

        
            
                <li class="header-item "><a href="/"><h3>Home</h3></a></li>
            
        
      
      <li class="header-item"><a href="/search"><h3><i class="fa fa-search"></i></h3></a></li>
    </ul>
  </div>
<div class="entry-header">
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Rails Project - Storyplan</h1>
      
        <h2><span class="entry-date date published updated"><time datetime="2016-04-22T08:00:00-05:00">April 22, 2016</time></span></h2>
      

      
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~5 minutes
        </p><!-- /.entry-reading-time -->
      
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->


<nav id="menu" style="display: none">
  <ul>
    
      
        <li><a href="/"><h3>Home</h3></a></li>
      
    
      
        <li><a href="/about"><h3>About</h3></a></li>
      
    
      
        <li><a href="/categories"><h3>Categories</h3></a>
          <ul>
            
              
                <li><a href="/categories/#rails">rails</a></li>
            
              
                <li><a href="/categories/#ruby">ruby</a></li>
            
              
                <li><a href="/categories/#sinatra">sinatra</a></li>
            
          </ul>
        </li>
      
    
  </ul>
</nav>


  <a href="https://twitter.com/mmystic" class="btn btn-info button-twitter" data-show-count="false" data-size="large"><i class="fa fa-twitter"></i> <span> | Follow @mmystic</span></a>



<div id="main" role="main">
  <article class="hentry">
    <div class="entry-content">
        
      <h1 class="post-title entry-title">Rails Project - Storyplan</h1>
      <p>Making a Rails application is hard. There are so many components, considerations, and features to be dealt with that the process can quickly become complicated and overwhelming, especially when you’re just starting out as a developer. For my first full-fledged Rails project, I’ll give an overview on how I broke down the process and attempted to build out the application one piece at a time.</p>

<p>The application is tentatively titled Storyplan and is intended as a tool to help writers plot out stories. Writing a story often requires a great deal of structure, planning, and constituent components, and I wanted to create a website that would make it easier to build and keep track of everything.</p>

<h2 id="models">Models</h2>

<p>I started by mapping out the models and migrations. Using the <code class="highlighter-rouge">rails generate resource</code> command, you can use Rails to generate a model, database migration for that model, and a controller, and I used it to get a head start. My models were as follows:</p>

<ul>
  <li><code class="highlighter-rouge">User</code> - Generated using the Devise gem for authentication.</li>
  <li><code class="highlighter-rouge">Story</code> - Belongs to a <code class="highlighter-rouge">User</code>.</li>
  <li><code class="highlighter-rouge">Chapter</code> - Belongs to a <code class="highlighter-rouge">Story</code>.</li>
  <li><code class="highlighter-rouge">Character</code> - Has many <code class="highlighter-rouge">Chapters</code> through a join table and vice versa, belongs to a <code class="highlighter-rouge">User</code>.</li>
  <li><code class="highlighter-rouge">Audience</code> - Has many <code class="highlighter-rouge">Stories</code> through a join table and vice versa.</li>
  <li><code class="highlighter-rouge">Genre</code> - Has many <code class="highlighter-rouge">Stories</code> through a join table and vice versa.</li>
  <li><code class="highlighter-rouge">Comment</code> - Belongs to both a <code class="highlighter-rouge">User</code> and a <code class="highlighter-rouge">Story</code>.</li>
</ul>

<p>With these models, I was able to set up the associations necessary to do things like show all the <code class="highlighter-rouge">Stories</code> of a <code class="highlighter-rouge">User</code> or all the <code class="highlighter-rouge">Characters</code> in a <code class="highlighter-rouge">Story</code>. This also makes it easier for a user to explore the different connections of a writer’s work.</p>

<p>These models have a variety of validations to ensure bad data isn’t entered into the system, as well as class and instance methods to give the models additional functionality beyond being mere data containers.</p>

<p><em>The <code class="highlighter-rouge">Story</code> model:</em></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Story</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
  <span class="n">has_many</span> <span class="ss">:story_genres</span>
  <span class="n">has_many</span> <span class="ss">:genres</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">distinct</span> <span class="p">},</span> <span class="ss">through: :story_genres</span>
  <span class="n">has_many</span> <span class="ss">:story_audiences</span>
  <span class="n">has_many</span> <span class="ss">:audiences</span><span class="p">,</span> <span class="ss">through: :story_audiences</span>
  <span class="n">has_many</span> <span class="ss">:chapters</span><span class="p">,</span> <span class="ss">dependent: :destroy</span> <span class="c1">#destroys all chapters belonging to it when the story is destroyed</span>
  <span class="n">has_many</span> <span class="ss">:characters</span><span class="p">,</span> <span class="ss">through: :chapters</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>

  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:target_word_count</span><span class="p">,</span> <span class="ss">numericality: </span><span class="p">{</span> <span class="ss">only_integer: </span><span class="kp">true</span> <span class="p">},</span> <span class="ss">allow_blank: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:overview</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">maximum: </span><span class="mi">4000</span> <span class="p">}</span>

  <span class="kp">extend</span> <span class="no">ClassOrderable</span>

  <span class="k">def</span> <span class="nf">recent_comments</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="s1">'created_at DESC'</span><span class="p">).</span><span class="nf">last</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<h2 id="routes-and-controllers">Routes and Controllers</h2>

<p>Unlike Sinatra, Rails has a separate router from its controllers and uses it to map the routes to actions in those controllers. My routes were mostly resources for the above mentioned models, with a few nested resources to do things like the find all the <code class="highlighter-rouge">Characters</code> of a particular <code class="highlighter-rouge">User</code>.</p>

<p><em><a href="https://github.com/MitulMistry/rails-storyplan/blob/master/config/routes.rb">See the routes file here.</a></em></p>

<p>As far as controllers are concerned, I used one controller per model with a few miscellaneous controllers thrown in as well to handle other tasks. This is basically a CRUD (Create, Read, Update, Delete) application, so many of the controllers handle similar tasks. So for example, the <code class="highlighter-rouge">Stories</code> controller handles serving all the stories for the stories index, showing a particular story, serving a form for a new story or editing an old one, processing the creation and update of a story based on input from the form, and destroying a story as well. These correspond to <a href="http://guides.rubyonrails.org/routing.html">RESTful routes</a> (Representational State Transfer): Index, Show, New, Create, Edit, Update, Destroy. This is simply a paradigm to keep things consistent across different web applications and is an example of Rails’s philosophy of convention over configuration.</p>

<p>There are other levels of complexity involved, such as authorization (making sure the user creating or updating a story has permission to do so) or white-listing the data received (using <a href="http://edgeguides.rubyonrails.org/action_controller_overview.html#strong-parameters">strong parameters</a>) from the form so no improper data is forcibly entered.</p>

<p><em><a href="https://github.com/MitulMistry/rails-storyplan/blob/master/app/controllers/stories_controller.rb">See the story controller here.</a></em></p>

<h2 id="views">Views</h2>
<p>For the front end, I used the <a href="https://github.com/twbs/bootstrap-sass">Bootstrap-Sass</a> gem for Rails. It has a very generic look to it, but for now it works to help it look presentable.</p>

<p>The views use a variety of partials to make the display code reusable. For example, for each model, there is a partial that creates a sort of visual card for it that includes pertinent information. I then use a grid system to display collections of that model.</p>

<p><em>Code for the story card partial:</em></p>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="n">story</span> <span class="o">=</span> <span class="n">item</span> <span class="k">unless</span> <span class="n">story</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-12 col-md-4"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"thumbnail"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"caption"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">story</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="n">story</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;p&gt;&lt;strong&gt;</span>Written by:<span class="nt">&lt;/strong&gt;</span> <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">story</span><span class="p">.</span><span class="nf">user</span><span class="p">.</span><span class="nf">username</span><span class="p">,</span> <span class="n">writer_path</span><span class="p">(</span><span class="n">story</span><span class="p">.</span><span class="nf">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;p&gt;&lt;strong&gt;</span>Overview: <span class="nt">&lt;/strong&gt;</span><span class="cp">&lt;%=</span> <span class="n">story_truncated_overview</span><span class="p">(</span><span class="n">story</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;p&gt;&lt;strong&gt;</span>Target word count:<span class="nt">&lt;/strong&gt;</span> <span class="cp">&lt;%=</span> <span class="n">story</span><span class="p">.</span><span class="nf">target_word_count</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">if</span> <span class="o">!</span><span class="n">story</span><span class="p">.</span><span class="nf">audiences</span><span class="p">.</span><span class="nf">empty?</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;p&gt;&lt;strong&gt;</span>Target audience:<span class="nt">&lt;/strong&gt;</span>
        <span class="cp">&lt;%</span> <span class="n">story</span><span class="p">.</span><span class="nf">audiences</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">audience</span><span class="o">|</span> <span class="cp">%&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">audience</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="n">audience</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"label label-warning"</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/p&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">if</span> <span class="o">!</span><span class="n">story</span><span class="p">.</span><span class="nf">genres</span><span class="p">.</span><span class="nf">empty?</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;p&gt;&lt;strong&gt;</span>Genres:<span class="nt">&lt;/strong&gt;</span>
        <span class="cp">&lt;%</span> <span class="n">story</span><span class="p">.</span><span class="nf">genres</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">genre</span><span class="o">|</span> <span class="cp">%&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">genre</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="n">genre</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"label label-primary"</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/p&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<p>So when you go to the stories index page, it displays a grid of stories that simply repeat that model partial with new information from each collection item.</p>

<h2 id="authentication">Authentication</h2>

<p>Setting up a secure login/logout system can be challenging considering the number of security threats out there. You can roll your own authentication using <a href="https://github.com/codahale/bcrypt-ruby">bcrypt</a> to securely store password hashes, but I wanted something with more functionality built in. That’s why I used the <a href="https://github.com/plataformatec/devise">Devise</a> gem which provides for the creation of its own <code class="highlighter-rouge">User</code> model and gives you additional tools like email confirmation should you desire them. Most importantly, it’s battle tested and commonly used to provide secure authentication for Rails applications.</p>

<p>In addition, I used Devise to provide OAuth authentication for Facebook, so you can securely sign in with a Facebook account as well.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Overall, this is just a small overview of what turned out to be a relatively complex project. There’s a lot more functionality I’d like to build eventually to make this more of a viable tool for writers, including building more of a front end, but for now it serves its purpose.</p>

<p>You can find the source code for this project <a href="https://github.com/MitulMistry/rails-storyplan">here on Github.</a></p>


      <footer class="entry-meta">
        <span class="entry-tags"></span>
        
        <span class="author vcard"><span class="fn">Mitul Mistry</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/ruby/rails/rails-project/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/ruby/rails/rails-project/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/ruby/rails/rails-project/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->

      </footer>
    </div><!-- /.entry-content -->
    <div class="read-more">
  <div class="read-more-header">
    <a href="http://mitulmistry.github.io/" class="read-more-btn">About the Author</a>
  </div><!-- /.read-more-header -->
  <div class="read-more-content author-info">
    <h3>Mitul Mistry</h3>
    <div class="author-container">
      <img class="author-img" src="/images/avatar_mm.jpg" alt="Mitul Mistry" />
      <div class="author-bio">I’m Mitul Mistry, a full-stack developer and designer. Contact me here: MitulMistryDev@gmail.com</div>
    </div>
    <div class="author-share">
      <ul class="list-inline social-buttons">
        
          <li><a href="https://github.com/MitulMistry" target="_blank"><i class="fa fa-github fa-fw"></i></a></li>
        
          <li><a href="https://linkedin.com/in/mitulmistry" target="_blank"><i class="fa fa-linkedin fa-fw"></i></a></li>
        
      </ul>
      
        <a aria-label="Follow @MitulMistry on GitHub" data-style="mega" href="https://github.com/MitulMistry" class="github-button">Follow @MitulMistry</a>
      
      <br>
      
        <a href="https://twitter.com/mmystic" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @mmystic</a>
      
    </div>
  </div>
</div>

    
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="/ruby/sinatra/sinatra-project/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="/ruby/sinatra/sinatra-project/" title="Sinatra Project - Simple Blog">Sinatra Project - Simple Blog</a></h3>
      <p>After learning the basics of Ruby and ORMs, I’ve been working on a project leveraging the Sinatra development framework. Along with Activ...&hellip; <a href="/ruby/sinatra/sinatra-project/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="/ruby/steam-cli-gem/" title="Steam Top Sellers CLI Gem">Steam Top Sellers CLI Gem</a></h4>
        <span>Published on January 13, 2016</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">window.jQuery || document.write('<script type="text/javascript" src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script type="text/javascript" src="/assets/js/scripts.min.js"></script>
<script type="text/javascript" async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
<script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>








<script type="text/javascript">
    sharing();
</script>



<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 Mitul Mistry</span>

  </footer>
</div><!-- /.footer-wrapper -->

</body>
</html>
